<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>2번 도구 · 입찰 프로그램</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      font-size: 14px;
      color-scheme: light dark;
    }
    body {
      margin: 0;
      padding: 0;
      background: #0f172a;
      color: #e5e7eb;
    }
    .app {
      max-width: 1100px;
      margin: 0 auto;
      padding: 16px;
      box-sizing: border-box;
    }
    h1, h2, h3 {
      margin: 0 0 8px;
      font-weight: 600;
    }
    h1 {
      font-size: 1.4rem;
    }
    h2 {
      font-size: 1.1rem;
      margin-top: 16px;
    }
    h3 {
      font-size: 1rem;
      margin-top: 12px;
    }
    .tagline {
      font-size: 0.9rem;
      color: #9ca3af;
      margin-bottom: 12px;
    }
    .grid {
      display: grid;
      grid-template-columns: 2fr 3fr;
      gap: 12px;
    }
    .grid-3 {
      display: grid;
      grid-template-columns: 2fr 3fr;
      gap: 12px;
      margin-top: 12px;
    }
    .card {
      background: #020617;
      border-radius: 10px;
      border: 1px solid #1e293b;
      padding: 10px 12px;
      box-sizing: border-box;
    }
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }
    .badge {
      font-size: 0.75rem;
      padding: 2px 6px;
      border-radius: 999px;
      background: #0f766e;
      color: #ecfdf5;
      white-space: nowrap;
    }
    label {
      display: block;
      font-size: 0.8rem;
      margin: 6px 0 2px;
      color: #cbd5f5;
    }
    input[type="text"],
    input[type="date"],
    input[type="number"],
    select,
    textarea {
      width: 100%;
      box-sizing: border-box;
      border-radius: 6px;
      border: 1px solid #1f2937;
      padding: 6px 8px;
      background: #020617;
      color: #e5e7eb;
      font-size: 0.85rem;
      outline: none;
    }
    textarea {
      min-height: 60px;
      resize: vertical;
    }
    input::placeholder,
    textarea::placeholder {
      color: #6b7280;
    }
    select {
      padding-right: 24px;
    }
    button {
      border-radius: 6px;
      border: 1px solid #1d4ed8;
      background: #1d4ed8;
      color: #e5e7eb;
      font-size: 0.8rem;
      padding: 6px 10px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    button.secondary {
      border-color: #4b5563;
      background: #111827;
    }
    button.danger {
      border-color: #b91c1c;
      background: #7f1d1d;
    }
    button:disabled {
      opacity: 0.4;
      cursor: default;
    }
    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 8px;
    }
    .summary-box {
      font-size: 0.8rem;
      color: #cbd5f5;
      line-height: 1.4;
    }
    .summary-highlight {
      color: #a5f3fc;
      font-weight: 500;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.8rem;
    }
    th, td {
      border-bottom: 1px solid #1f2937;
      padding: 4px 6px;
      text-align: left;
    }
    th {
      background: #020617;
      position: sticky;
      top: 0;
      z-index: 1;
    }
    .table-wrapper {
      max-height: 260px;
      overflow: auto;
      border-radius: 6px;
      border: 1px solid #1f2937;
      background: #020617;
      margin-top: 4px;
    }
    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 4px;
    }
    .pill {
      padding: 2px 6px;
      border-radius: 999px;
      background: #111827;
      font-size: 0.75rem;
      color: #9ca3af;
      border: 1px solid #1f2937;
      white-space: nowrap;
    }
    .log-list {
      font-size: 0.75rem;
      max-height: 160px;
      overflow: auto;
      padding-left: 16px;
      margin: 4px 0 0;
    }
    .log-list li {
      margin-bottom: 2px;
      color: #9ca3af;
    }
    .badge-small {
      font-size: 0.7rem;
      padding: 1px 4px;
      border-radius: 999px;
      background: #111827;
      color: #9ca3af;
      border: 1px solid #1f2937;
    }
    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 2px;
    }
    .row > div {
      flex: 1 1 120px;
    }
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #22c55e;
    }
    .status-dot.warn {
      background: #facc15;
    }
    .status-dot.err {
      background: #ef4444;
    }
    .status-line {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 0.75rem;
      color: #9ca3af;
    }
    @media (max-width: 900px) {
      .grid,
      .grid-3 {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
<div class="app">
  <header class="card">
    <div class="card-header">
      <div>
        <h1>2번 도구 · 입찰 프로그램</h1>
        <div class="tagline">
          기관·마감일·품목·금액을 한 화면에서 정리하고, 나중에 다시 꺼내 쓸 수 있게 만드는 입찰 도움 도구입니다.  
          (Local-only · Safe DOM · index.html 하나로 동작)
        </div>
      </div>
      <div>
        <div class="badge">Bid Tool v1.0</div>
        <div style="font-size:0.75rem;color:#9ca3af;margin-top:4px;">
          저장 위치: <span class="badge-small">localStorage: wic_bid_tool_state_v1</span>
        </div>
      </div>
    </div>
  </header>

  <!-- 0. 요약 상태 -->
  <section class="card">
    <div class="card-header">
      <h2>0. 요약 상태 · 한눈에 보기</h2>
      <button id="refreshSummaryBtn" class="secondary">요약 새로고침</button>
    </div>
    <div class="summary-box" id="summaryBox">
      ● 저장된 입찰 안건: <span class="summary-highlight" id="summaryCount">0</span> 건  
      ● 오늘 기준 마감 안건: <span class="summary-highlight" id="summaryToday">0</span> 건  
      ● 최근 기관: <span class="summary-highlight" id="summaryLastOrg">-</span>  
      ● 최근 상태: <span class="status-line">
        <span class="status-dot" id="summaryStatusDot"></span><span id="summaryStatusText">정상</span>
      </span>
    </div>
    <div style="font-size:0.75rem;color:#9ca3af;margin-top:4px;">
      읽기 흐름 예시: ① 요약에서 오늘 해야 할 일을 보고 → ② 왼쪽에서 안건을 작성 → ③ 오른쪽 표에서 이전 안건을 다시 꺼내 씁니다.
    </div>
  </section>

  <!-- 1+2 기본정보 + 품목 -->
  <section class="grid">
    <!-- 왼쪽: 기본 정보 -->
    <div class="card">
      <div class="card-header">
        <h2>1. 기본 정보</h2>
        <button id="fillExampleBtn" class="secondary">예시 넣기</button>
      </div>

      <label for="orgName">기관 / 발주처 *</label>
      <input id="orgName" type="text" placeholder="예: KIST 세종 분원, KITECH, ○○공단" />

      <label for="bidTitle">입찰 제목 / 안건명 *</label>
      <input id="bidTitle" type="text" placeholder="예: 2026년 해외시장 보고서 구매 입찰" />

      <div class="row">
        <div>
          <label for="bidDeadline">마감일 *</label>
          <input id="bidDeadline" type="date" />
        </div>
        <div>
          <label for="bidBudget">예산 (숫자)</label>
          <input id="bidBudget" type="number" placeholder="예: 12000000" />
        </div>
      </div>

      <div class="row">
        <div>
          <label for="bidType">입찰 유형</label>
          <select id="bidType">
            <option value="">선택 없음</option>
            <option value="공개">공개</option>
            <option value="지명">지명</option>
            <option value="수의">수의</option>
          </select>
        </div>
        <div>
          <label for="bidStatus">진행 상태</label>
          <select id="bidStatus">
            <option value="준비중">준비중</option>
            <option value="제출완료">제출완료</option>
            <option value="낙찰">낙찰</option>
            <option value="미선정">미선정</option>
          </select>
        </div>
      </div>

      <label for="bidContact">담당자 / 연락처</label>
      <input id="bidContact" type="text" placeholder="예: 홍길동 / 010-1234-5678 / email@domain" />

      <label for="bidNote">내부 메모</label>
      <textarea id="bidNote" placeholder="예: 필수 제출 서류, 서식 번호, 특이 조건 등"></textarea>

      <div class="btn-row">
        <button id="saveCurrentBtn">현재 안건 저장</button>
        <button id="clearCurrentBtn" class="secondary">입력 지우기</button>
      </div>
    </div>

    <!-- 오른쪽: 품목 + 안건 목록 -->
    <div class="card">
      <div class="card-header">
        <h2>2. 품목 / 보고서 목록</h2>
        <span class="badge-small" id="itemSummaryBadge">품목 0개</span>
      </div>

      <div class="row">
        <div>
          <label for="itemName">품목 / 보고서 이름</label>
          <input id="itemName" type="text" placeholder="예: 글라스 서브스트레이트 시장 보고서" />
        </div>
        <div>
          <label for="itemCode">내부 코드</label>
          <input id="itemCode" type="text" placeholder="예: WIC-GLASS-2026-01" />
        </div>
      </div>

      <div class="row">
        <div>
          <label for="itemQty">수량</label>
          <input id="itemQty" type="number" placeholder="예: 1" />
        </div>
        <div>
          <label for="itemPrice">단가 (선택)</label>
          <input id="itemPrice" type="number" placeholder="예: 4800000" />
        </div>
      </div>

      <label for="itemNote">비고</label>
      <input id="itemNote" type="text" placeholder="예: PDF + 서적 세트, 옵션 포함 등" />

      <div class="btn-row">
        <button id="addItemBtn">품목 추가</button>
        <button id="clearItemsBtn" class="secondary">품목 모두 지우기</button>
      </div>

      <div class="table-wrapper" style="margin-top:8px;">
        <table>
          <thead>
          <tr>
            <th style="width:36px;">#</th>
            <th>품목</th>
            <th style="width:70px;">수량</th>
            <th style="width:90px;">단가</th>
            <th style="width:70px;">관리</th>
          </tr>
          </thead>
          <tbody id="itemsTableBody">
          <tr><td colspan="5" style="color:#6b7280;">아직 품목이 없습니다.</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- 3. 안건 목록 + 검색 -->
  <section class="grid-3">
    <div class="card">
      <div class="card-header">
        <h2>3. 저장된 입찰 안건</h2>
        <button id="refreshListBtn" class="secondary">목록 새로고침</button>
      </div>

      <label for="searchKeyword">검색 (기관 / 제목 / 담당자)</label>
      <input id="searchKeyword" type="text" placeholder="예: KIST, 글라스, 세종" />

      <div class="btn-row">
        <button id="searchBtn" class="secondary">검색</button>
        <button id="resetSearchBtn" class="secondary">검색 지우기</button>
      </div>

      <div class="table-wrapper" style="margin-top:8px;">
        <table>
          <thead>
          <tr>
            <th style="width:40px;">선택</th>
            <th>기관 / 제목</th>
            <th style="width:80px;">마감일</th>
            <th style="width:70px;">상태</th>
          </tr>
          </thead>
          <tbody id="bidListBody">
          <tr><td colspan="4" style="color:#6b7280;">저장된 안건이 없습니다.</td></tr>
          </tbody>
        </table>
      </div>

      <div class="btn-row" style="margin-top:8px;">
        <button id="loadSelectedBtn">선택 안건 불러오기</button>
        <button id="deleteSelectedBtn" class="danger">선택 안건 삭제</button>
      </div>
    </div>

    <!-- 4. 로그 -->
    <div class="card">
      <div class="card-header">
        <h2>4. 로그 · 상태 기록</h2>
        <button id="clearLogsBtn" class="secondary">로그 지우기</button>
      </div>
      <div style="font-size:0.8rem;color:#9ca3af;">
        ● 중요한 동작(저장, 삭제, 불러오기, 품목 추가 등)을 짧게 기록합니다.  
        ● 문제 생기면 이 기록만 읽어도 최근 흐름을 떠올릴 수 있습니다.
      </div>
      <ul class="log-list" id="logList"></ul>
    </div>
  </section>
</div>

<script>
(function () {
  const STORAGE_KEY = "wic_bid_tool_state_v1";

  /** @type {{bids: any[], logs: string[]}} */
  let state = {
    bids: [],
    logs: []
  };

  // 요소 찾기
  const orgNameEl = document.getElementById("orgName");
  const bidTitleEl = document.getElementById("bidTitle");
  const bidDeadlineEl = document.getElementById("bidDeadline");
  const bidBudgetEl = document.getElementById("bidBudget");
  const bidTypeEl = document.getElementById("bidType");
  const bidStatusEl = document.getElementById("bidStatus");
  const bidContactEl = document.getElementById("bidContact");
  const bidNoteEl = document.getElementById("bidNote");

  const itemNameEl = document.getElementById("itemName");
  const itemCodeEl = document.getElementById("itemCode");
  const itemQtyEl = document.getElementById("itemQty");
  const itemPriceEl = document.getElementById("itemPrice");
  const itemNoteEl = document.getElementById("itemNote");
  const itemsTableBody = document.getElementById("itemsTableBody");
  const itemSummaryBadge = document.getElementById("itemSummaryBadge");

  const summaryCountEl = document.getElementById("summaryCount");
  const summaryTodayEl = document.getElementById("summaryToday");
  const summaryLastOrgEl = document.getElementById("summaryLastOrg");
  const summaryStatusDot = document.getElementById("summaryStatusDot");
  const summaryStatusText = document.getElementById("summaryStatusText");

  const bidListBody = document.getElementById("bidListBody");
  const logListEl = document.getElementById("logList");

  const saveCurrentBtn = document.getElementById("saveCurrentBtn");
  const clearCurrentBtn = document.getElementById("clearCurrentBtn");
  const addItemBtn = document.getElementById("addItemBtn");
  const clearItemsBtn = document.getElementById("clearItemsBtn");
  const refreshSummaryBtn = document.getElementById("refreshSummaryBtn");
  const refreshListBtn = document.getElementById("refreshListBtn");
  const fillExampleBtn = document.getElementById("fillExampleBtn");
  const clearLogsBtn = document.getElementById("clearLogsBtn");
  const searchKeywordEl = document.getElementById("searchKeyword");
  const searchBtn = document.getElementById("searchBtn");
  const resetSearchBtn = document.getElementById("resetSearchBtn");
  const loadSelectedBtn = document.getElementById("loadSelectedBtn");
  const deleteSelectedBtn = document.getElementById("deleteSelectedBtn");

  function nowText() {
    const d = new Date();
    const pad = (n) => String(n).padStart(2, "0");
    return (
      d.getFullYear() +
      "-" +
      pad(d.getMonth() + 1) +
      "-" +
      pad(d.getDate()) +
      " " +
      pad(d.getHours()) +
      ":" +
      pad(d.getMinutes())
    );
  }

  function addLog(message) {
    const line = "[" + nowText() + "] " + message;
    state.logs.unshift(line);
    // 100개까지만
    if (state.logs.length > 100) state.logs = state.logs.slice(0, 100);
    renderLogs();
    saveState();
  }

  function saveState() {
    try {
      const toSave = JSON.stringify(state);
      window.localStorage.setItem(STORAGE_KEY, toSave);
    } catch (e) {
      console.error(e);
    }
  }

  function loadState() {
    try {
      const raw = window.localStorage.getItem(STORAGE_KEY);
      if (!raw) return;
      const parsed = JSON.parse(raw);
      if (parsed && Array.isArray(parsed.bids)) {
        state.bids = parsed.bids;
      }
      if (parsed && Array.isArray(parsed.logs)) {
        state.logs = parsed.logs;
      }
    } catch (e) {
      console.error(e);
    }
  }

  function currentItemListFromForm() {
    const current = window.__currentItems || [];
    return current;
  }

  function setCurrentItemList(list) {
    window.__currentItems = Array.isArray(list) ? list : [];
    renderItemsTable();
  }

  function renderLogs() {
    logListEl.innerHTML = "";
    if (state.logs.length === 0) {
      const li = document.createElement("li");
      li.textContent = "기록이 아직 없습니다.";
      li.style.color = "#6b7280";
      logListEl.appendChild(li);
      return;
    }
    state.logs.forEach((line) => {
      const li = document.createElement("li");
      li.textContent = line;
      logListEl.appendChild(li);
    });
  }

  function renderItemsTable() {
    const items = currentItemListFromForm();
    itemsTableBody.innerHTML = "";
    if (items.length === 0) {
      const tr = document.createElement("tr");
      const td = document.createElement("td");
      td.colSpan = 5;
      td.style.color = "#6b7280";
      td.textContent = "아직 품목이 없습니다.";
      tr.appendChild(td);
      itemsTableBody.appendChild(tr);
      itemSummaryBadge.textContent = "품목 0개";
      return;
    }
    items.forEach((item, idx) => {
      const tr = document.createElement("tr");

      const tdIndex = document.createElement("td");
      tdIndex.textContent = String(idx + 1);
      tr.appendChild(tdIndex);

      const tdName = document.createElement("td");
      tdName.innerHTML =
        "<strong>" +
        (item.name || "-") +
        "</strong><br/><span style='color:#9ca3af;font-size:0.7rem;'>" +
        (item.code || "") +
        "</span>";
      tr.appendChild(tdName);

      const tdQty = document.createElement("td");
      tdQty.textContent = item.qty ? String(item.qty) : "-";
      tr.appendChild(tdQty);

      const tdPrice = document.createElement("td");
      tdPrice.textContent = item.price ? String(item.price) : "-";
      tr.appendChild(tdPrice);

      const tdActions = document.createElement("td");
      const delBtn = document.createElement("button");
      delBtn.textContent = "삭제";
      delBtn.className = "danger";
      delBtn.style.fontSize = "0.7rem";
      delBtn.onclick = () => {
        const list = currentItemListFromForm();
        list.splice(idx, 1);
        setCurrentItemList(list);
        addLog("품목 삭제: " + (item.name || "-"));
      };
      tdActions.appendChild(delBtn);
      tr.appendChild(tdActions);

      itemsTableBody.appendChild(tr);
    });
    itemSummaryBadge.textContent = "품목 " + items.length + "개";
  }

  function renderBidList(filtered) {
    const list = filtered || state.bids;
    bidListBody.innerHTML = "";
    if (list.length === 0) {
      const tr = document.createElement("tr");
      const td = document.createElement("td");
      td.colSpan = 4;
      td.style.color = "#6b7280";
      td.textContent = "저장된 안건이 없습니다.";
      tr.appendChild(td);
      bidListBody.appendChild(tr);
      return;
    }

    list.forEach((bid) => {
      const tr = document.createElement("tr");

      const tdRadio = document.createElement("td");
      const input = document.createElement("input");
      input.type = "radio";
      input.name = "bidSelected";
      input.value = bid.id;
      tdRadio.appendChild(input);
      tr.appendChild(tdRadio);

      const tdInfo = document.createElement("td");
      tdInfo.innerHTML =
        "<strong>" +
        (bid.orgName || "-") +
        "</strong><br/><span style='color:#9ca3af;font-size:0.7rem;'>" +
        (bid.bidTitle || "-") +
        "</span>";
      tr.appendChild(tdInfo);

      const tdDeadline = document.createElement("td");
      tdDeadline.textContent = bid.bidDeadline || "-";
      tr.appendChild(tdDeadline);

      const tdStatus = document.createElement("td");
      tdStatus.textContent = bid.bidStatus || "-";
      tr.appendChild(tdStatus);

      bidListBody.appendChild(tr);
    });
  }

  function renderSummary() {
    const total = state.bids.length;
    summaryCountEl.textContent = String(total);

    const today = new Date();
    const pad = (n) => String(n).padStart(2, "0");
    const todayStr =
      today.getFullYear() +
      "-" +
      pad(today.getMonth() + 1) +
      "-" +
      pad(today.getDate());

    const todayCount = state.bids.filter(
      (b) => b.bidDeadline === todayStr
    ).length;
    summaryTodayEl.textContent = String(todayCount);

    if (total === 0) {
      summaryLastOrgEl.textContent = "-";
    } else {
      const last = state.bids[state.bids.length - 1];
      summaryLastOrgEl.textContent = last.orgName || "-";
    }

    summaryStatusDot.className = "status-dot";
    summaryStatusText.textContent = "정상";
  }

  function getCurrentBidFromForm() {
    const items = currentItemListFromForm();
    return {
      id: window.__currentBidId || null,
      orgName: orgNameEl.value.trim(),
      bidTitle: bidTitleEl.value.trim(),
      bidDeadline: bidDeadlineEl.value,
      bidBudget: bidBudgetEl.value ? Number(bidBudgetEl.value) : null,
      bidType: bidTypeEl.value,
      bidStatus: bidStatusEl.value || "준비중",
      bidContact: bidContactEl.value.trim(),
      bidNote: bidNoteEl.value.trim(),
      items,
      updatedAt: nowText()
    };
  }

  function setFormFromBid(bid) {
    window.__currentBidId = bid.id || null;
    orgNameEl.value = bid.orgName || "";
    bidTitleEl.value = bid.bidTitle || "";
    bidDeadlineEl.value = bid.bidDeadline || "";
    bidBudgetEl.value = bid.bidBudget != null ? String(bid.bidBudget) : "";
    bidTypeEl.value = bid.bidType || "";
    bidStatusEl.value = bid.bidStatus || "준비중";
    bidContactEl.value = bid.bidContact || "";
    bidNoteEl.value = bid.bidNote || "";
    setCurrentItemList(bid.items || []);
  }

  function clearForm() {
    window.__currentBidId = null;
    orgNameEl.value = "";
    bidTitleEl.value = "";
    bidDeadlineEl.value = "";
    bidBudgetEl.value = "";
    bidTypeEl.value = "";
    bidStatusEl.value = "준비중";
    bidContactEl.value = "";
    bidNoteEl.value = "";
    setCurrentItemList([]);
  }

  // 이벤트 연결
  addItemBtn.addEventListener("click", function () {
    const name = itemNameEl.value.trim();
    const code = itemCodeEl.value.trim();
    const qty = itemQtyEl.value ? Number(itemQtyEl.value) : null;
    const price = itemPriceEl.value ? Number(itemPriceEl.value) : null;
    const note = itemNoteEl.value.trim();

    if (!name) {
      alert("품목 이름을 입력해 주세요.");
      return;
    }
    const list = currentItemListFromForm();
    list.push({ name, code, qty, price, note });
    setCurrentItemList(list);
    itemNameEl.value = "";
    itemCodeEl.value = "";
    itemQtyEl.value = "";
    itemPriceEl.value = "";
    itemNoteEl.value = "";
    addLog("품목 추가: " + name);
  });

  clearItemsBtn.addEventListener("click", function () {
    if (!confirm("현재 품목을 모두 지울까요?")) return;
    setCurrentItemList([]);
    addLog("품목 모두 삭제");
  });

  saveCurrentBtn.addEventListener("click", function () {
    const bid = getCurrentBidFromForm();
    if (!bid.orgName || !bid.bidTitle || !bid.bidDeadline) {
      alert("기관, 제목, 마감일은 필수입니다.");
      return;
    }

    if (!bid.id) {
      bid.id = "bid_" + Date.now() + "_" + Math.random().toString(36).slice(2);
      state.bids.push(bid);
      window.__currentBidId = bid.id;
      addLog("새 입찰 안건 저장: " + bid.orgName + " / " + bid.bidTitle);
    } else {
      const idx = state.bids.findIndex((b) => b.id === bid.id);
      if (idx >= 0) {
        state.bids[idx] = bid;
        addLog("입찰 안건 수정: " + bid.orgName + " / " + bid.bidTitle);
      } else {
        state.bids.push(bid);
        addLog("입찰 안건 저장(새로): " + bid.orgName + " / " + bid.bidTitle);
      }
    }

    saveState();
    renderBidList();
    renderSummary();
  });

  clearCurrentBtn.addEventListener("click", function () {
    if (!confirm("현재 입력을 모두 지울까요?")) return;
    clearForm();
    addLog("입력 초기화");
  });

  refreshSummaryBtn.addEventListener("click", function () {
    renderSummary();
    addLog("요약 상태 새로고침");
  });

  refreshListBtn.addEventListener("click", function () {
    renderBidList();
    addLog("입찰 안건 목록 새로고침");
  });

  fillExampleBtn.addEventListener("click", function () {
    orgNameEl.value = "KIST 세종 분원";
    bidTitleEl.value = "2026년 해외 시장·기술 보고서 구매 입찰";
    const today = new Date();
    const pad = (n) => String(n).padStart(2, "0");
    const d = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);
    bidDeadlineEl.value =
      d.getFullYear() + "-" + pad(d.getMonth() + 1) + "-" + pad(d.getDate());
    bidBudgetEl.value = "12000000";
    bidTypeEl.value = "공개";
    bidStatusEl.value = "준비중";
    bidContactEl.value = "홍길동 / 010-1234-5678 / user@example.com";
    bidNoteEl.value = "서식 ○○번, 필수 첨부: 사업자등록증, 실적증명 등";

    setCurrentItemList([
      {
        name: "글라스 서브스트레이트 시장 보고서 2026",
        code: "WIC-GLASS-2026-01",
        qty: 1,
        price: 4800000,
        note: "서적 + PDF 세트"
      },
      {
        name: "반도체 패키징 재료 시장 보고서",
        code: "WIC-PKG-2026-02",
        qty: 1,
        price: 5200000,
        note: "PDF 단독"
      }
    ]);

    addLog("예시 데이터 입력");
  });

  clearLogsBtn.addEventListener("click", function () {
    if (!confirm("로그를 모두 지울까요?")) return;
    state.logs = [];
    renderLogs();
    saveState();
  });

  searchBtn.addEventListener("click", function () {
    const kw = searchKeywordEl.value.trim().toLowerCase();
    if (!kw) {
      renderBidList();
      return;
    }
    const filtered = state.bids.filter((b) => {
      const org = (b.orgName || "").toLowerCase();
      const title = (b.bidTitle || "").toLowerCase();
      const contact = (b.bidContact || "").toLowerCase();
      return (
        org.includes(kw) || title.includes(kw) || contact.includes(kw)
      );
    });
    renderBidList(filtered);
    addLog("검색 실행: " + kw);
  });

  resetSearchBtn.addEventListener("click", function () {
    searchKeywordEl.value = "";
    renderBidList();
    addLog("검색 초기화");
  });

  loadSelectedBtn.addEventListener("click", function () {
    const checked = document.querySelector(
      'input[name="bidSelected"]:checked'
    );
    if (!checked) {
      alert("불러올 안건을 선택해 주세요.");
      return;
    }
    const id = checked.value;
    const bid = state.bids.find((b) => b.id === id);
    if (!bid) return;
    setFormFromBid(bid);
    addLog("입찰 안건 불러오기: " + (bid.orgName || "-"));
  });

  deleteSelectedBtn.addEventListener("click", function () {
    const checked = document.querySelector(
      'input[name="bidSelected"]:checked'
    );
    if (!checked) {
      alert("삭제할 안건을 선택해 주세요.");
      return;
    }
    if (!confirm("선택한 안건을 삭제할까요?")) return;
    const id = checked.value;
    const idx = state.bids.findIndex((b) => b.id === id);
    if (idx >= 0) {
      const removed = state.bids.splice(idx, 1)[0];
      saveState();
      renderBidList();
      renderSummary();
      addLog(
        "입찰 안건 삭제: " + ((removed && removed.orgName) || "-")
      );
    }
  });

  // 초기 로딩
  loadState();
  renderLogs();
  renderBidList();
  renderSummary();
  setCurrentItemList(window.__currentItems || []);

})();
</script>
</body>
</html>
